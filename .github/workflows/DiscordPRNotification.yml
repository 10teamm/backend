name: Discord PR 알림 (세분화)

on:
  pull_request:
    types: [opened, reopened, synchronize]
    branches:
      - main
      - develo

jobs:
  notify-discord:
    runs-on: ubuntu-latest

    steps:
      - name: Discord 알림 전송 (PR 생성)
        if: github.event.action == 'opened'
        uses: tsickert/discord-webhook@v2
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          payload: |
            {
              "username": "백엔드 알림",
              "embeds": [
                {
                  "title": "🙌 새로운 Pull Request가 생성됐어요!",
                  "description": "**레포지토리:** `${{ github.repository }}`\n**브랜치:** `${{ github.base_ref }}`\n\n**PR 제목:** `${{ github.event.pull_request.title }}`",
                  "url": "${{ github.event.pull_request.html_url }}",
                  "color": 65280,
                  "author": {
                    "name": "${{ github.event.pull_request.user.login }}",
                    "icon_url": "${{ github.event.pull_request.user.avatar_url }}"
                  },
                  "fields": [
                    {
                      "name": "작성자",
                      "value": "${{ github.event.pull_request.user.login }}",
                      "inline": true
                    },
                    {
                      "name": "브랜치",
                      "value": "${{ github.head_ref }}",
                      "inline": true
                    },
                    {
                      "name": "상태",
                      "value": "새로운 PR이 열렸습니다.",
                      "inline": false
                    }
                  ],
                  "timestamp": "${{ github.event.pull_request.created_at }}",
                  "footer": {
                  }
                }
              ]
            }

      - name: Discord 알림 전송 (PR 다시 열림)
        if: github.event.action == 'reopened'
        uses: tsickert/discord-webhook@v2
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          payload: |
            {
              "username": "백엔드 알림",
              "embeds": [
                {
                  "title": "🔄 Pull Request가 다시 열렸습니다!",
                  "description": "**레포지토리:** `${{ github.repository }}`\n**브랜치:** `${{ github.base_ref }}`\n\n**PR 제목:** `${{ github.event.pull_request.title }}`",
                  "url": "${{ github.event.pull_request.html_url }}",
                  "color": 16776960,
                  "author": {
                    "name": "${{ github.event.pull_request.user.login }}",
                    "icon_url": "${{ github.event.pull_request.user.avatar_url }}"
                  },
                  "fields": [
                    {
                      "name": "작성자",
                      "value": "${{ github.event.pull_request.user.login }}",
                      "inline": true
                    },
                    {
                      "name": "브랜치",
                      "value": "${{ github.head_ref }}",
                      "inline": true
                    },
                    {
                      "name": "상태",
                      "value": "PR이 다시 열렸습니다.",
                      "inline": false
                    }
                  ],
                  "timestamp": "${{ github.event.pull_request.updated_at }}",
                  "footer": {
                  }
                }
              ]
            }

      - name: Discord 알림 전송 (PR 업데이트)
        if: github.event.action == 'synchronize'
        uses: tsickert/discord-webhook@v2
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          payload: |
            {
              "username": "백엔드 알림",
              "embeds": [
                {
                  "title": "✏️ Pull Request에 새 커밋이 푸시되었습니다!",
                  "description": "**레포지토리:** `${{ github.repository }}`\n**브랜치:** `${{ github.base_ref }}`\n\n**PR 제목:** `${{ github.event.pull_request.title }}`",
                  "url": "${{ github.event.pull_request.html_url }}",
                  "color": 3447003,
                  "author": {
                    "name": "${{ github.event.pull_request.user.login }}",
                    "icon_url": "${{ github.event.pull_request.user.avatar_url }}"
                  },
                  "fields": [
                    {
                      "name": "작성자",
                      "value": "${{ github.event.pull_request.user.login }}",
                      "inline": true
                    },
                    {
                      "name": "브랜치",
                      "value": "${{ github.head_ref }}",
                      "inline": true
                    },
                    {
                      "name": "상태",
                      "value": "PR에 새로운 변경사항이 푸시되었습니다.",
                      "inline": false
                    }
                  ],
                  "timestamp": "${{ github.event.pull_request.updated_at }}",
                  "footer": {
                  }
                }
              ]
            }